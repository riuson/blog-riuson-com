<!DOCTYPE html>
<html lang="ru">
<head>
      <title>riuson.com - BB & Qt — ICU</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Pelican" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="riuson's blog">
    <meta name="author" content="riuson">
    <!-- Bootstrap core CSS -->
    <link href="https://www.riuson.com/theme/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom fonts for this template -->
    <link href="https://www.riuson.com/theme/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <!-- Custom styles for this template -->
    <link href="https://www.riuson.com/theme/css/clean-blog.min.css" rel="stylesheet">
    <link href="https://www.riuson.com/theme/css/pygments.css" rel="stylesheet">




    <meta name="tags" content="Qt" />

</head>

<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
    <div class="container">
      <a class="navbar-brand" href="https://www.riuson.com/">riuson.com</a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        Menu
        <i class="fas fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
              <li class="nav-link">
                <a href="https://www.riuson.com/ru/about">О</a>
              </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Page Header -->
  <header class="masthead" style="background-image: url('https://www.riuson.com/theme/img/post-bg.jpg')">
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
  <div class="post-heading">
    <h1>BB & Qt — ICU</h1>
    <span class="meta">
      <time class="published" datetime="2014-07-15T21:58:00+05:00">
        15 Июль 2014 г., Вт
      </time>
    </span>
    <span class="meta">
      
    </span>
  </div>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="row">
      <div class="col-lg-10 col-md-12 mx-auto">
  <article>
    <p>Сборка International Components for Unicode (ICU) для ARMv7. Используется в Qt с 5 версии.</p>
<p>На основе статьи <a href="http://starofrainnight-eng.blogspot.ru/2013/08/cross-compile-icu-512.html">Cross Compile ICU 51.2</a>.</p>
<p>Идём на <a href="http://site.icu-project.org/download">сайт проекта ICU</a>. Переходим по ссылке на последнюю версию ICU4C. Там скачиваем архив исходников, под названием "gzipped tar archive for Unix and other platforms".
Распаковываем в каталог <i>/home/user/Qt/icu</i> .</p>
<p>Сначала надо будет собрать ICU для текущей операционной системы.
Заходим в каталог icu и делаем копию исходников:</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">cd</span> /home/user/Qt/icu
$ cp -r <span class="nb">source</span> source_host
$ <span class="nb">cd</span> source_host
</code></pre></div>


<p>Собираем:</p>
<div class="highlight"><pre><span></span><code>$ ./configure
$ make
</code></pre></div>


<p>Теперь настраиваем основной каталог исходников.</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">cd</span> /home/user/Qt/icu/source
$ touch build.sh
chmod +x build.sh
nano build.sh
</code></pre></div>


<p>В файле пишем команды конфигурации и сборки:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>

<span class="nv">PATH</span><span class="o">=</span>/home/user/beaglebone/gcc-linaro-arm-linux-gnueabi-4.8-2014.03_linux/bin:<span class="nv">$PATH</span>
<span class="nb">export</span> PATH
<span class="nb">export</span> <span class="nv">TOOLCHAIN_TARGET_SYSTEM</span><span class="o">=</span>arm-linux-gnueabihf
<span class="nb">export</span> <span class="nv">TOOLCHAIN_INSTALL_DIRECTORY</span><span class="o">=</span>/usr/share/icu-4c-53.1-armv7

./configure <span class="nv">CC</span><span class="o">=</span><span class="nv">$TOOLCHAIN_TARGET_SYSTEM</span>-gcc <span class="nv">CXX</span><span class="o">=</span><span class="nv">$TOOLCHAIN_TARGET_SYSTEM</span>-g++ <span class="nv">CPP</span><span class="o">=</span><span class="nv">$TOOLCHAIN_TARGET_SYSTEM</span>-cpp --host<span class="o">=</span><span class="nv">$TOOLCHAIN_TARGET_SYSTEM</span> --prefix<span class="o">=</span><span class="nv">$TOOLCHAIN_INSTALL_DIRECTORY</span> --enable-shared<span class="o">=</span>yes --enable-tests<span class="o">=</span>no --enable-samples<span class="o">=</span>no --with-cross-build<span class="o">=</span>/home/user/Qt/icu/source_host

make
</code></pre></div>


<p>Сохраняем (Ctrl+O, Enter) и выходим (Ctrl+X).</p>
<p><span style="text-decoration: underline;">Для исправления бага с загрузкой библиотеки <i>libicudata.so</i></span>:</p>
<blockquote>
<p>error white loading shared libraries: libicudata.so.53: cannot open shared object file: No such file or directory</p>
</blockquote>
<p>открываем файл <i>icu/source/mh-linux</i> и комментируем эту строку:</p>
<div class="highlight"><pre><span></span><code><span class="nv">LDFLAGSICUDT</span><span class="o">=</span>-nodefaultlibs -nostdlib
</code></pre></div>


<p>Решение найдено <a href="http://stackoverflow.com/questions/17687336/icu-49-built-on-a-debian-system-fails-to-load-libicudata-so">здесь</a>. Без этого исправления ldd -v libicudata.so.53 говорит, что библиотека statically linked. А после исправления - уже обычный вывод.</p>
<p>Собираем и устанавливаем:</p>
<div class="highlight"><pre><span></span><code>$ ./build.sh
$ sudo make install
</code></pre></div>


<p>Каталог <i>/usr/share/icu-4c-53.1-armv7</i> копируем на BeagleBone.</p>
  </article>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-lg-10 col-md-12 mx-auto">
  <div class="category">
    <a href="https://www.riuson.com/category/beaglebone.html">/BeagleBone</a>
  </div>
  <div class="tags">
        <a href="https://www.riuson.com/tag/qt.html">#Qt</a>
  </div>

<hr>

        </div>
      </div>
    </div>
  </footer>

  <!-- Bootstrap core JavaScript -->
  <script src="https://www.riuson.com/theme/vendor/jquery/jquery.min.js"></script>
  <script src="https://www.riuson.com/theme/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Custom scripts for this template -->
  <script src="https://www.riuson.com/theme/js/clean-blog.min.js"></script>

</body>
</html>